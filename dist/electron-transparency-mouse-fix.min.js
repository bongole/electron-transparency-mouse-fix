'use strict';function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}var electron=require('electron');var consoleTag=['%celectron-transparency-mouse-fix',"margin-right: .25em;padding: .1em .4em;border-radius: .25em;background-color: #3eabdc;color: white;font-weight: bold;"];var TransparencyMouseFix=function(){function TransparencyMouseFix(){var _this=this;var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$electronWindow=_ref.electronWindow,electronWindow=_ref$electronWindow===void 0?electron.remote.getCurrentWindow():_ref$electronWindow,_ref$htmlWindow=_ref.htmlWindow,htmlWindow=_ref$htmlWindow===void 0?window:_ref$htmlWindow,_ref$fixPointerEvents=_ref.fixPointerEvents,fixPointerEvents=_ref$fixPointerEvents===void 0?'auto':_ref$fixPointerEvents,_ref$log=_ref.log,log=_ref$log===void 0?false:_ref$log;_classCallCheck(this,TransparencyMouseFix);this.electronWindow=electronWindow;this.htmlWindow=htmlWindow;this._ignoringMouse=true;this.altCheckHover._instanceCount=0;this._scopedOnMouseEvent=function(event){return _this.onMouseEvent(event);};this._scopedAltCheckHover=function(){return _this.altCheckHover();};this.log=log;this.fixPointerEvents=fixPointerEvents;this.registerWindow();this.htmlWindow.addEventListener('beforeunload',function(){sessionStorage.setItem('etmf-reloaded','true');});}_createClass(TransparencyMouseFix,[{key:"registerWindow",value:function registerWindow(){var _this2=this;this.htmlWindow.addEventListener('mousemove',this._scopedOnMouseEvent);this.htmlWindow.addEventListener('dragover',this._scopedOnMouseEvent);var styleSheet=this.htmlWindow.document.createElement('style');styleSheet.classList.add('etmf-css');styleSheet.innerHTML="\n      html {pointer-events: none}\n      body {position: relative}\n    ";this.htmlWindow.addEventListener('beforeunload',function(){return _this2.unregisterWindow(_this2.htmlWindow);});this.log&&this.log('info','Registered event listener');}},{key:"unregisterWindow",value:function unregisterWindow(){this.htmlWindow.removeEventListener('mousemove',this._scopedOnMouseEvent);this.htmlWindow.removeEventListener('dragover',this._scopedOnMouseEvent);this.electronWindow.setIgnoreMouseEvents(false);this.log&&this.log('info','Removed event listener');}},{key:"onMouseEvent",value:function onMouseEvent(event){this.log&&this.log('debug',event);var sinkHole=event.target.classList.contains('etmf-void');if(event.type==='dragover'){event.preventDefault();if(!sinkHole)return;}var reachedBottom=event.target===this.htmlWindow.document.documentElement;var ignoreEvents=sinkHole||reachedBottom;if(ignoreEvents){if(this._ignoringMouse)return;this._ignoringMouse=true;if(this.fixPointerEvents){this.electronWindow.setIgnoreMouseEvents(true,{forward:false});this.altCheckHover(true);this.log&&this.log('info','mouse off (polling)');}else{this.electronWindow.setIgnoreMouseEvents(true,{forward:true});this.log&&this.log('info','mouse off (listening)');}}else{if(!this._ignoringMouse)return;this._ignoringMouse=false;this.electronWindow.setIgnoreMouseEvents(false);this.log&&this.log('info','mouse on (listening)');}}},{key:"altCheckHover",value:function altCheckHover(){var first=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(first){this.altCheckHover._instanceCount++;}if(this.altCheckHover._instanceCount>1){this.log&&this.log('warn','aborting',this.altCheckHover._instanceCount,'parallel altCheckHover polls');this.altCheckHover._instanceCount--;return null;}var _electron$screen$getC=electron.screen.getCursorScreenPoint(),x=_electron$screen$getC.x,y=_electron$screen$getC.y;var _this$electronWindow$=this.electronWindow.getContentBounds(),left=_this$electronWindow$.x,top=_this$electronWindow$.y,width=_this$electronWindow$.width,height=_this$electronWindow$.height;this.log&&this.log('debug',{mouse:{x:x,y:y},window:{left:left,top:top,width:width,height:height}});if(x>=left&&x<left+width&&y>=top&&y<top+height){var tgt=document.elementFromPoint(x-left,y-top);if(tgt&&!tgt.classList.contains('etmf-void')&&tgt!==this.htmlWindow.document.documentElement){this.onMouseEvent({target:tgt});this.altCheckHover._instanceCount--;return true;}}requestAnimationFrame(this._scopedAltCheckHover);return false;}},{key:"log",get:function get(){return this._log;},set:function set(fn){if(typeof fn==='function'){this._log=fn;}else if(fn){this._log=function(level){var _console;for(var _len=arguments.length,msg=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){msg[_key-1]=arguments[_key];}(_console=console)[level].apply(_console,consoleTag.concat(msg));};}else{this._log=false;}}},{key:"fixPointerEvents",get:function get(){return this._fixPointerEvents;},set:function set(condition){condition=condition?typeof condition==='string'?condition.toLowerCase():true:false;switch(condition){case false:case'off':this._fixPointerEvents=false;break;case'force':this._fixPointerEvents=true;break;case'linux':this._fixPointerEvents=process.platform!=='win32'&&process.platform!=='darwin';break;case'auto':default:this._fixPointerEvents=false;if(process.platform==='win32'){if(sessionStorage.getItem('etmf-reloaded')==='true')this._fixPointerEvents=true;}else if(process.platform!=='darwin'){this._fixPointerEvents=true;}break;}if(this._fixPointerEvents)this.altCheckHover(true);}}]);return TransparencyMouseFix;}();module.exports=TransparencyMouseFix;

//# sourceMappingURL=electron-transparency-mouse-fix.min.js.map